// src/contexts/LanguageContext.tsx

import React, { createContext, useContext, useMemo, useState, useEffect, useCallback } from "react";
import storage from "../utils/persistentStorage";

export type Language = "fr" | "en" | "es" | "pt" | "zh" | "ja";

type LanguageCtx = {
  language: Language;
  setLanguage: (l: Language) => Promise<void>;
  t: (key: string) => string;
};

const STORAGE_KEY = "app_language";

const LANGUAGE_NAMES: Record<Language, string> = {
  fr: "Fran√ßais",
  en: "English", 
  es: "Espa√±ol",
  pt: "Portugu√™s",
  zh: "‰∏≠Êñá",
  ja: "Êó•Êú¨Ë™û",
};

const LANGUAGE_FLAGS: Record<Language, string> = {
  fr: "üá´üá∑",
  en: "üá∫üá∏",
  es: "üá™üá∏", 
  pt: "üáµüáπ",
  zh: "üá®üá≥",
  ja: "üáØüáµ",
};

const SUPPORTED_LANGUAGES: Language[] = ["fr", "en", "es", "pt", "zh", "ja"];

// Traductions
const translations: Record<Language, Record<string, string>> = {
  fr: {
    // Navigation
    "nav.home": "Accueil",
    "nav.advisor": "Conseiller",
    "nav.stats": "Statistiques", 
    "nav.settings": "Param√®tres",
    
    // Home Screen
    "home.title": "CashHeal",
    "home.subtitle": "G√©rez vos finances intelligemment",
    "home.balance": "Solde",
    "home.available": "Disponible",
    "home.spent": "D√©pens√©",
    "home.budget": "Budget",
    "home.add_expense": "Ajouter une d√©pense",
    "home.categories": "Cat√©gories",
    "home.food": "Nourriture",
    "home.shopping": "Shopping",
    "home.leisure": "Loisirs",
    "home.welcome_heading": "Bienvenue !",
    "home.greeting": "Bonjour üëã",
    "home.welcome_subtitle": "Pr√™t √† soigner vos finances ?",
    "home.today_spent": "Tu as d√©pens√© aujourd'hui",
    "home.daily_budget": "Budget du jour",
    "home.remaining_today": "Il te reste {amount} pour aujourd'hui.",
    "home.period_day": "Jour",
    "home.period_2weeks": "2 semaines",
    "home.period_month": "Mois",
    "home.weekly_average": "Moyenne cette semaine",
    "home.prediction": "Pr√©diction",
    "home.dashboard_title": "Tableau de bord",
    "home.modal_add_title": "Ajouter une d√©pense",
    "home.modal_remove_title": "Annuler une d√©pense",
    "home.modal_category": "Cat√©gorie",
    "home.modal_amount": "Montant",
    "home.modal_amount_placeholder": "Montant",
    
    // Budget Advisor
    "advisor.title": "Conseiller Budg√©taire",
    "advisor.subtitle": "Cr√©ons votre plan financier personnalis√©",
    "advisor.monthly_budget": "Quel est votre budget mensuel ?",
    "advisor.rent": "Quel est votre loyer mensuel ?",
    "advisor.daily_spending": "Combien voulez-vous d√©penser par jour ?",
    "advisor.weekly_spending": "Combien voulez-vous d√©penser par semaine ?",
    "advisor.biweekly_spending": "Combien voulez-vous d√©penser toutes les 2 semaines ?",
    "advisor.monthly_spending": "Combien voulez-vous d√©penser par mois ?",
    "advisor.savings_goal": "Quel est votre objectif d'√©pargne ?",
    "advisor.savings_30": "S√©curit√© maximale (30% d'√©pargne)",
    "advisor.savings_balanced": "Juste milieu (15% d'√©pargne)",
    "advisor.savings_invest": "Investissement (5% d'√©pargne)",
    "advisor.calculate": "Calculer mon plan",
    "advisor.save": "Sauvegarder",
    "advisor.continue": "Continuer",
    "advisor.back": "Retour",
    "advisor.result_title": "Votre plan budg√©taire",
    "advisor.fixed_charges": "Charges fixes",
    "advisor.available_spending": "Disponible pour d√©penser",
    "advisor.daily_budget": "Budget quotidien",
    "advisor.weekly_budget": "Budget hebdomadaire",
    "advisor.biweekly_budget": "Budget bi-hebdomadaire",
    
    // Settings
    "settings.title": "Param√®tres",
    "settings.currency": "Devise",
    "settings.language": "Langue",
    "settings.country": "Pays",
    "settings.notifications": "Notifications",
    "settings.biometric": "Authentification biom√©trique",
    "settings.dark_mode": "Mode sombre",
    "settings.personal_info": "Informations personnelles",
    "settings.logout": "Se d√©connecter",
    "settings.subtitle": "Personnalisez votre exp√©rience",
    "settings.section_preferences": "Pr√©f√©rences",
    "settings.section_security": "S√©curit√©",
    "settings.section_appearance": "Apparence",
    "settings.section_account": "Compte",
    "settings.section_actions": "Actions",
    "settings.choose_language": "S√©lectionnez votre langue pr√©f√©r√©e",
    "settings.choose_country": "S√©lectionnez votre pays",
    "settings.currency_modal_title": "Choisir une devise",
    "settings.currency_modal_use_saved": "Utiliser la devise du plan sauvegard√©",
    "settings.push_notifications_title": "Notifications push",
    "settings.push_notifications_subtitle": "Recevoir des notifications sur vos d√©penses",
    "settings.biometric_title": "Authentification biom√©trique",
    "settings.biometric_subtitle": "Utiliser Face ID ou Touch ID",
    "settings.dark_mode_title": "Mode sombre",
    "settings.dark_mode_subtitle": "Activer le th√®me sombre",
    "settings.personal_info_title": "Informations personnelles",
    "settings.personal_info_subtitle": "Modifier votre profil",
    "settings.personal_info_alert_title": "Profil",
    "settings.personal_info_alert_body": "Fonctionnalit√© √† venir",
    "settings.logout_title": "Se d√©connecter",
    "settings.logout_subtitle": "D√©connexion de votre compte",
    "settings.delete_account_title": "Supprimer le compte",
    "settings.delete_account_subtitle": "Supprimer d√©finitivement votre compte",
    
    // Common
    "common.save": "Sauvegarder",
    "common.cancel": "Annuler",
    "common.confirm": "Confirmer",
    "common.error": "Erreur",
    "common.success": "Succ√®s",
    "common.loading": "Chargement...",
    "home.prediction_message_day_default": "Tu as d√©pens√© moins que pr√©vu aujourd'hui, continue ainsi !",
    "home.prediction_message_2weeks_default": "Tu es sur la bonne voie pour rester sous ton budget.",
    "home.prediction_message_month_default": "Tu peux viser un peu plus d'√©pargne ce mois-ci.",
    "home.category_food": "Nourriture",
    "home.category_shopping": "Shopping",
    "home.category_leisure": "Loisirs",
    "details.title": "Plan budg√©taire rapide",
    "details.monthly_income_label": "Revenu mensuel (EUR)",
    "details.monthly_income_placeholder": "Ex. 2500",
    "details.savings_target_label": "Objectif d‚Äô√©pargne mensuel",
    "details.savings_target_placeholder": "Ex. 700",
    "details.calculate_button": "Calculer",
    "details.recommendations_title": "Recommandations",
    "details.recommendations_monthly": "D√©penses mensuelles : {amount}",
    "details.recommendations_weekly": "D√©penses hebdo : {amount}",
    "details.recommendations_daily": "D√©penses quotidiennes : {amount}",
    "details.go_to_advisor": "Aller au plan d√©taill√©",
  },
  
  en: {
    // Navigation
    "nav.home": "Home",
    "nav.advisor": "Advisor",
    "nav.stats": "Statistics",
    "nav.settings": "Settings",
    
    // Home Screen
    "home.title": "CashHeal",
    "home.subtitle": "Manage your finances smartly",
    "home.balance": "Balance",
    "home.available": "Available",
    "home.spent": "Spent",
    "home.budget": "Budget",
    "home.add_expense": "Add expense",
    "home.categories": "Categories",
    "home.food": "Food",
    "home.shopping": "Shopping",
    "home.leisure": "Leisure",
    "home.welcome_heading": "Welcome!",
    "home.greeting": "Hello üëã",
    "home.welcome_subtitle": "Ready to heal your finances?",
    "home.today_spent": "You've spent today",
    "home.daily_budget": "Today's budget",
    "home.remaining_today": "You still have {amount} for today.",
    "home.period_day": "Day",
    "home.period_2weeks": "2 weeks",
    "home.period_month": "Month",
    "home.weekly_average": "Average this week",
    "home.prediction": "Prediction",
    "home.dashboard_title": "Dashboard",
    "home.modal_add_title": "Add an expense",
    "home.modal_remove_title": "Remove an expense",
    "home.modal_category": "Category",
    "home.modal_amount": "Amount",
    "home.modal_amount_placeholder": "Amount",
    
    // Budget Advisor
    "advisor.title": "Budget Advisor",
    "advisor.subtitle": "Let's create your personalized financial plan",
    "advisor.monthly_budget": "What is your monthly budget?",
    "advisor.rent": "What is your monthly rent?",
    "advisor.daily_spending": "How much do you want to spend per day?",
    "advisor.weekly_spending": "How much do you want to spend per week?",
    "advisor.biweekly_spending": "How much do you want to spend every 2 weeks?",
    "advisor.monthly_spending": "How much do you want to spend per month?",
    "advisor.savings_goal": "What is your savings goal?",
    "advisor.savings_30": "Maximum security (30% savings)",
    "advisor.savings_balanced": "Balanced (15% savings)",
    "advisor.savings_invest": "Investment (5% savings)",
    "advisor.calculate": "Calculate my plan",
    "advisor.save": "Save",
    "advisor.continue": "Continue",
    "advisor.back": "Back",
    "advisor.result_title": "Your budget plan",
    "advisor.fixed_charges": "Fixed charges",
    "advisor.available_spending": "Available for spending",
    "advisor.daily_budget": "Daily budget",
    "advisor.weekly_budget": "Weekly budget",
    "advisor.biweekly_budget": "Bi-weekly budget",
    
    // Settings
    "settings.title": "Settings",
    "settings.currency": "Currency",
    "settings.language": "Language",
    "settings.country": "Country",
    "settings.notifications": "Notifications",
    "settings.biometric": "Biometric authentication",
    "settings.dark_mode": "Dark mode",
    "settings.personal_info": "Personal information",
    "settings.logout": "Logout",
    "settings.subtitle": "Personalise your experience",
    "settings.section_preferences": "Preferences",
    "settings.section_security": "Security",
    "settings.section_appearance": "Appearance",
    "settings.section_account": "Account",
    "settings.section_actions": "Actions",
    "settings.choose_language": "Select your preferred language",
    "settings.choose_country": "Select your country",
    "settings.currency_modal_title": "Choose a currency",
    "settings.currency_modal_use_saved": "Use saved plan currency",
    "settings.push_notifications_title": "Push notifications",
    "settings.push_notifications_subtitle": "Receive spending alerts",
    "settings.biometric_title": "Biometric authentication",
    "settings.biometric_subtitle": "Use Face ID or Touch ID",
    "settings.dark_mode_title": "Dark mode",
    "settings.dark_mode_subtitle": "Enable dark theme",
    "settings.personal_info_title": "Personal information",
    "settings.personal_info_subtitle": "Edit your profile",
    "settings.personal_info_alert_title": "Profile",
    "settings.personal_info_alert_body": "Feature coming soon",
    "settings.logout_title": "Logout",
    "settings.logout_subtitle": "Sign out of your account",
    "settings.delete_account_title": "Delete account",
    "settings.delete_account_subtitle": "Permanently delete your account",
    
    // Common
    "common.save": "Save",
    "common.cancel": "Cancel",
    "common.confirm": "Confirm",
    "common.error": "Error",
    "common.success": "Success",
    "common.loading": "Loading...",
    "home.prediction_message_day_default": "You spent less than expected today, keep it up!",
    "home.prediction_message_2weeks_default": "You're on track to stay under budget.",
    "home.prediction_message_month_default": "You can aim for a bit more savings this month.",
    "home.category_food": "Food",
    "home.category_shopping": "Shopping",
    "home.category_leisure": "Leisure",
    "details.title": "Quick budget plan",
    "details.monthly_income_label": "Monthly income (EUR)",
    "details.monthly_income_placeholder": "Ex. 2500",
    "details.savings_target_label": "Monthly savings goal",
    "details.savings_target_placeholder": "Ex. 700",
    "details.calculate_button": "Calculate",
    "details.recommendations_title": "Recommendations",
    "details.recommendations_monthly": "Monthly spending: {amount}",
    "details.recommendations_weekly": "Weekly spending: {amount}",
    "details.recommendations_daily": "Daily spending: {amount}",
    "details.go_to_advisor": "Go to detailed plan",
  },
  
  es: {
    // Navigation
    "nav.home": "Inicio",
    "nav.advisor": "Asesor",
    "nav.stats": "Estad√≠sticas",
    "nav.settings": "Configuraci√≥n",
    
    // Home Screen
    "home.title": "CashHeal",
    "home.subtitle": "Gestiona tus finanzas inteligentemente",
    "home.balance": "Saldo",
    "home.available": "Disponible",
    "home.spent": "Gastado",
    "home.budget": "Presupuesto",
    "home.add_expense": "Agregar gasto",
    "home.categories": "Categor√≠as",
    "home.food": "Comida",
    "home.shopping": "Compras",
    "home.leisure": "Ocio",
    "home.welcome_heading": "¬°Bienvenido!",
    "home.greeting": "Hola üëã",
    "home.welcome_subtitle": "¬øListo para sanar tus finanzas?",
    "home.today_spent": "Has gastado hoy",
    "home.daily_budget": "Presupuesto de hoy",
    "home.remaining_today": "Te quedan {amount} para hoy.",
    "home.period_day": "D√≠a",
    "home.period_2weeks": "2 semanas",
    "home.period_month": "Mes",
    "home.weekly_average": "Promedio esta semana",
    "home.prediction": "Predicci√≥n",
    "home.dashboard_title": "Panel de control",
    "home.modal_add_title": "Agregar un gasto",
    "home.modal_remove_title": "Eliminar un gasto",
    "home.modal_category": "Categor√≠a",
    "home.modal_amount": "Monto",
    "home.modal_amount_placeholder": "Monto",
    
    // Budget Advisor
    "advisor.title": "Asesor Presupuestario",
    "advisor.subtitle": "Creemos tu plan financiero personalizado",
    "advisor.monthly_budget": "¬øCu√°l es tu presupuesto mensual?",
    "advisor.rent": "¬øCu√°l es tu alquiler mensual?",
    "advisor.daily_spending": "¬øCu√°nto quieres gastar por d√≠a?",
    "advisor.weekly_spending": "¬øCu√°nto quieres gastar por semana?",
    "advisor.biweekly_spending": "¬øCu√°nto quieres gastar cada 2 semanas?",
    "advisor.monthly_spending": "¬øCu√°nto quieres gastar por mes?",
    "advisor.savings_goal": "¬øCu√°l es tu objetivo de ahorro?",
    "advisor.savings_30": "M√°xima seguridad (30% ahorro)",
    "advisor.savings_balanced": "Equilibrado (15% ahorro)",
    "advisor.savings_invest": "Inversi√≥n (5% ahorro)",
    "advisor.calculate": "Calcular mi plan",
    "advisor.save": "Guardar",
    "advisor.continue": "Continuar",
    "advisor.back": "Atr√°s",
    "advisor.result_title": "Tu plan presupuestario",
    "advisor.fixed_charges": "Cargos fijos",
    "advisor.available_spending": "Disponible para gastar",
    "advisor.daily_budget": "Presupuesto diario",
    "advisor.weekly_budget": "Presupuesto semanal",
    "advisor.biweekly_budget": "Presupuesto quincenal",
    
    // Settings
    "settings.title": "Configuraci√≥n",
    "settings.currency": "Moneda",
    "settings.language": "Idioma",
    "settings.country": "Pa√≠s",
    "settings.notifications": "Notificaciones",
    "settings.biometric": "Autenticaci√≥n biom√©trica",
    "settings.dark_mode": "Modo oscuro",
    "settings.personal_info": "Informaci√≥n personal",
    "settings.logout": "Cerrar sesi√≥n",
    "settings.subtitle": "Personaliza tu experiencia",
    "settings.section_preferences": "Preferencias",
    "settings.section_security": "Seguridad",
    "settings.section_appearance": "Apariencia",
    "settings.section_account": "Cuenta",
    "settings.section_actions": "Acciones",
    "settings.choose_language": "Selecciona tu idioma preferido",
    "settings.choose_country": "Selecciona tu pa√≠s",
    "settings.currency_modal_title": "Elegir una moneda",
    "settings.currency_modal_use_saved": "Usar la moneda del plan guardado",
    "settings.push_notifications_title": "Notificaciones push",
    "settings.push_notifications_subtitle": "Recibir notificaciones sobre tus gastos",
    "settings.biometric_title": "Autenticaci√≥n biom√©trica",
    "settings.biometric_subtitle": "Usar Face ID o Touch ID",
    "settings.dark_mode_title": "Modo oscuro",
    "settings.dark_mode_subtitle": "Activar el tema oscuro",
    "settings.personal_info_title": "Informaci√≥n personal",
    "settings.personal_info_subtitle": "Modificar tu perfil",
    "settings.personal_info_alert_title": "Perfil",
    "settings.personal_info_alert_body": "Funci√≥n pr√≥ximamente",
    "settings.logout_title": "Cerrar sesi√≥n",
    "settings.logout_subtitle": "Cerrar tu cuenta",
    "settings.delete_account_title": "Eliminar cuenta",
    "settings.delete_account_subtitle": "Eliminar tu cuenta definitivamente",
    
    // Common
    "common.save": "Guardar",
    "common.cancel": "Cancelar",
    "common.confirm": "Confirmar",
    "common.error": "Error",
    "common.success": "√âxito",
    "common.loading": "Cargando...",
    "home.prediction_message_day_default": "Has gastado menos de lo previsto hoy, ¬°sigue as√≠!",
    "home.prediction_message_2weeks_default": "Vas por buen camino para mantenerte bajo el presupuesto.",
    "home.prediction_message_month_default": "Puedes apuntar a un poco m√°s de ahorro este mes.",
    "home.category_food": "Comida",
    "home.category_shopping": "Compras",
    "home.category_leisure": "Ocio",
    "details.title": "Plan de presupuesto r√°pido",
    "details.monthly_income_label": "Ingresos mensuales (EUR)",
    "details.monthly_income_placeholder": "Ej. 2500",
    "details.savings_target_label": "Objetivo de ahorro mensual",
    "details.savings_target_placeholder": "Ej. 700",
    "details.calculate_button": "Calcular",
    "details.recommendations_title": "Recomendaciones",
    "details.recommendations_monthly": "Gastos mensuales: {amount}",
    "details.recommendations_weekly": "Gastos semanales: {amount}",
    "details.recommendations_daily": "Gastos diarios: {amount}",
    "details.go_to_advisor": "Ir al plan detallado",
  },
  
  pt: {
    // Navigation
    "nav.home": "In√≠cio",
    "nav.advisor": "Consultor",
    "nav.stats": "Estat√≠sticas",
    "nav.settings": "Configura√ß√µes",
    
    // Home Screen
    "home.title": "CashHeal",
    "home.subtitle": "Gerencie suas finan√ßas inteligentemente",
    "home.balance": "Saldo",
    "home.available": "Dispon√≠vel",
    "home.spent": "Gasto",
    "home.budget": "Or√ßamento",
    "home.add_expense": "Adicionar despesa",
    "home.categories": "Categorias",
    "home.food": "Comida",
    "home.shopping": "Compras",
    "home.leisure": "Lazer",
    "home.welcome_heading": "Bem-vindo!",
    "home.greeting": "Ol√° üëã",
    "home.welcome_subtitle": "Pronto para cuidar das suas finan√ßas?",
    "home.today_spent": "Voc√™ gastou hoje",
    "home.daily_budget": "Or√ßamento de hoje",
    "home.remaining_today": "Voc√™ ainda tem {amount} para hoje.",
    "home.period_day": "Dia",
    "home.period_2weeks": "2 semanas",
    "home.period_month": "M√™s",
    "home.weekly_average": "M√©dia desta semana",
    "home.prediction": "Previs√£o",
    "home.dashboard_title": "Painel",
    "home.modal_add_title": "Adicionar despesa",
    "home.modal_remove_title": "Remover despesa",
    "home.modal_category": "Categoria",
    "home.modal_amount": "Quantia",
    "home.modal_amount_placeholder": "Quantia",
    
    // Budget Advisor
    "advisor.title": "Consultor Or√ßament√°rio",
    "advisor.subtitle": "Vamos criar seu plano financeiro personalizado",
    "advisor.monthly_budget": "Qual √© seu or√ßamento mensal?",
    "advisor.rent": "Qual √© seu aluguel mensal?",
    "advisor.daily_spending": "Quanto voc√™ quer gastar por dia?",
    "advisor.weekly_spending": "Quanto voc√™ quer gastar por semana?",
    "advisor.biweekly_spending": "Quanto voc√™ quer gastar a cada 2 semanas?",
    "advisor.monthly_spending": "Quanto voc√™ quer gastar por m√™s?",
    "advisor.savings_goal": "Qual √© seu objetivo de poupan√ßa?",
    "advisor.savings_30": "M√°xima seguran√ßa (30% poupan√ßa)",
    "advisor.savings_balanced": "Equilibrado (15% poupan√ßa)",
    "advisor.savings_invest": "Investimento (5% poupan√ßa)",
    "advisor.calculate": "Calcular meu plano",
    "advisor.save": "Salvar",
    "advisor.continue": "Continuar",
    "advisor.back": "Voltar",
    "advisor.result_title": "Seu plano or√ßament√°rio",
    "advisor.fixed_charges": "Custos fixos",
    "advisor.available_spending": "Dispon√≠vel para gastar",
    "advisor.daily_budget": "Or√ßamento di√°rio",
    "advisor.weekly_budget": "Or√ßamento semanal",
    "advisor.biweekly_budget": "Or√ßamento quinzenal",
    
    // Settings
    "settings.title": "Configura√ß√µes",
    "settings.currency": "Moeda",
    "settings.language": "Idioma",
    "settings.country": "Pa√≠s",
    "settings.notifications": "Notifica√ß√µes",
    "settings.biometric": "Autentica√ß√£o biom√©trica",
    "settings.dark_mode": "Modo escuro",
    "settings.personal_info": "Informa√ß√µes pessoais",
    "settings.logout": "Sair",
    "settings.subtitle": "Personalize sua experi√™ncia",
    "settings.section_preferences": "Prefer√™ncias",
    "settings.section_security": "Seguran√ßa",
    "settings.section_appearance": "Apar√™ncia",
    "settings.section_account": "Conta",
    "settings.section_actions": "A√ß√µes",
    "settings.choose_language": "Selecione seu idioma preferido",
    "settings.choose_country": "Selecione seu pa√≠s",
    "settings.currency_modal_title": "Escolher uma moeda",
    "settings.currency_modal_use_saved": "Usar moeda do plano salvo",
    "settings.push_notifications_title": "Notifica√ß√µes push",
    "settings.push_notifications_subtitle": "Receber alertas de gastos",
    "settings.biometric_title": "Autentica√ß√£o biom√©trica",
    "settings.biometric_subtitle": "Usar Face ID ou Touch ID",
    "settings.dark_mode_title": "Modo escuro",
    "settings.dark_mode_subtitle": "Ativar tema escuro",
    "settings.personal_info_title": "Informa√ß√µes pessoais",
    "settings.personal_info_subtitle": "Editar seu perfil",
    "settings.personal_info_alert_title": "Perfil",
    "settings.personal_info_alert_body": "Funcionalidade em breve",
    "settings.logout_title": "Sair",
    "settings.logout_subtitle": "Desconectar da sua conta",
    "settings.delete_account_title": "Excluir conta",
    "settings.delete_account_subtitle": "Excluir sua conta permanentemente",
    
    // Common
    "common.save": "Salvar",
    "common.cancel": "Cancelar",
    "common.confirm": "Confirmar",
    "common.error": "Erro",
    "common.success": "Sucesso",
    "common.loading": "Carregando...",
    "home.prediction_message_day_default": "Voc√™ gastou menos do que o previsto hoje, continue assim!",
    "home.prediction_message_2weeks_default": "Voc√™ est√° no caminho certo para ficar abaixo do or√ßamento.",
    "home.prediction_message_month_default": "Voc√™ pode buscar um pouco mais de economia este m√™s.",
    "home.category_food": "Comida",
    "home.category_shopping": "Compras",
    "home.category_leisure": "Lazer",
    "details.title": "Plano r√°pido de or√ßamento",
    "details.monthly_income_label": "Renda mensal (EUR)",
    "details.monthly_income_placeholder": "Ex. 2500",
    "details.savings_target_label": "Meta de poupan√ßa mensal",
    "details.savings_target_placeholder": "Ex. 700",
    "details.calculate_button": "Calcular",
    "details.recommendations_title": "Recomenda√ß√µes",
    "details.recommendations_monthly": "Gastos mensais: {amount}",
    "details.recommendations_weekly": "Gastos semanais: {amount}",
    "details.recommendations_daily": "Gastos di√°rios: {amount}",
    "details.go_to_advisor": "Ir para o plano detalhado",
  },
  
  zh: {
    // Navigation
    "nav.home": "È¶ñÈ°µ",
    "nav.advisor": "È°æÈóÆ",
    "nav.stats": "ÁªüËÆ°",
    "nav.settings": "ËÆæÁΩÆ",
    
    // Home Screen
    "home.title": "CashHeal",
    "home.subtitle": "Êô∫ËÉΩÁÆ°ÁêÜÊÇ®ÁöÑË¥¢Âä°",
    "home.balance": "‰ΩôÈ¢ù",
    "home.available": "ÂèØÁî®",
    "home.spent": "Â∑≤Ëä±Ë¥π",
    "home.budget": "È¢ÑÁÆó",
    "home.add_expense": "Ê∑ªÂä†ÊîØÂá∫",
    "home.categories": "Á±ªÂà´",
    "home.food": "È£üÁâ©",
    "home.shopping": "Ë¥≠Áâ©",
    "home.leisure": "‰ºëÈó≤",
    "home.welcome_heading": "Ê¨¢ËøéÔºÅ",
    "home.greeting": "‰Ω†Â•Ω üëã",
    "home.welcome_subtitle": "ÂáÜÂ§áÂ•ΩÊä§ÁêÜ‰Ω†ÁöÑË¥¢Âä°‰∫ÜÂêóÔºü",
    "home.today_spent": "‰Ω†‰ªäÂ§©Â∑≤ÁªèËä±Ë¥π",
    "home.daily_budget": "‰ªäÊó•È¢ÑÁÆó",
    "home.remaining_today": "‰ªäÂ§©ËøòÂâ© {amount} ÂèØÁî®„ÄÇ",
    "home.period_day": "Êó•",
    "home.period_2weeks": "‰∏§Âë®",
    "home.period_month": "Êúà",
    "home.weekly_average": "Êú¨Âë®Âπ≥Âùá",
    "home.prediction": "È¢ÑÊµã",
    "home.dashboard_title": "‰ª™Ë°®Êùø",
    "home.modal_add_title": "Ê∑ªÂä†ÊîØÂá∫",
    "home.modal_remove_title": "ÂèñÊ∂àÊîØÂá∫",
    "home.modal_category": "Á±ªÂà´",
    "home.modal_amount": "ÈáëÈ¢ù",
    "home.modal_amount_placeholder": "ÈáëÈ¢ù",
    
    // Budget Advisor
    "advisor.title": "È¢ÑÁÆóÈ°æÈóÆ",
    "advisor.subtitle": "ËÆ©Êàë‰ª¨ÂàõÂª∫ÊÇ®ÁöÑ‰∏™ÊÄßÂåñË¥¢Âä°ËÆ°Âàí",
    "advisor.monthly_budget": "ÊÇ®ÁöÑÊúàÈ¢ÑÁÆóÊòØÂ§öÂ∞ëÔºü",
    "advisor.rent": "ÊÇ®ÁöÑÊúàÁßüÈáëÊòØÂ§öÂ∞ëÔºü",
    "advisor.daily_spending": "ÊÇ®ÊØèÂ§©ÊÉ≥Ëä±Â§öÂ∞ëÈí±Ôºü",
    "advisor.weekly_spending": "ÊÇ®ÊØèÂë®ÊÉ≥Ëä±Â§öÂ∞ëÈí±Ôºü",
    "advisor.biweekly_spending": "ÊÇ®ÊØè‰∏§Âë®ÊÉ≥Ëä±Â§öÂ∞ëÈí±Ôºü",
    "advisor.monthly_spending": "ÊÇ®ÊØèÊúàÊÉ≥Ëä±Â§öÂ∞ëÈí±Ôºü",
    "advisor.savings_goal": "ÊÇ®ÁöÑÂÇ®ËìÑÁõÆÊ†áÊòØ‰ªÄ‰πàÔºü",
    "advisor.savings_30": "ÊúÄÂ§ßÂÆâÂÖ®ÊÄßÔºà30%ÂÇ®ËìÑÔºâ",
    "advisor.savings_balanced": "Âπ≥Ë°°Ôºà15%ÂÇ®ËìÑÔºâ",
    "advisor.savings_invest": "ÊäïËµÑÔºà5%ÂÇ®ËìÑÔºâ",
    "advisor.calculate": "ËÆ°ÁÆóÊàëÁöÑËÆ°Âàí",
    "advisor.save": "‰øùÂ≠ò",
    "advisor.continue": "ÁªßÁª≠",
    "advisor.back": "ËøîÂõû",
    "advisor.result_title": "ÊÇ®ÁöÑÈ¢ÑÁÆóËÆ°Âàí",
    "advisor.fixed_charges": "Âõ∫ÂÆöË¥πÁî®",
    "advisor.available_spending": "ÂèØÁî®‰∫éÊîØÂá∫",
    "advisor.daily_budget": "ÊØèÊó•È¢ÑÁÆó",
    "advisor.weekly_budget": "ÊØèÂë®È¢ÑÁÆó",
    "advisor.biweekly_budget": "ÂèåÂë®È¢ÑÁÆó",
    
    // Settings
    "settings.title": "ËÆæÁΩÆ",
    "settings.currency": "Ë¥ßÂ∏Å",
    "settings.language": "ËØ≠Ë®Ä",
    "settings.country": "ÂõΩÂÆ∂",
    "settings.notifications": "ÈÄöÁü•",
    "settings.biometric": "ÁîüÁâ©ËØÜÂà´ËÆ§ËØÅ",
    "settings.dark_mode": "Ê∑±Ëâ≤Ê®°Âºè",
    "settings.personal_info": "‰∏™‰∫∫‰ø°ÊÅØ",
    "settings.logout": "ÈÄÄÂá∫ÁôªÂΩï",
    "settings.subtitle": "Ëá™ÂÆö‰πâÊÇ®ÁöÑ‰ΩìÈ™å",
    "settings.section_preferences": "ÂÅèÂ•ΩËÆæÁΩÆ",
    "settings.section_security": "ÂÆâÂÖ®",
    "settings.section_appearance": "Â§ñËßÇ",
    "settings.section_account": "Ë¥¶Êà∑",
    "settings.section_actions": "Êìç‰Ωú",
    "settings.choose_language": "ÈÄâÊã©ÊÇ®ÁöÑÈ¶ñÈÄâËØ≠Ë®Ä",
    "settings.choose_country": "ÈÄâÊã©ÊÇ®ÁöÑÂõΩÂÆ∂",
    "settings.currency_modal_title": "ÈÄâÊã©Ë¥ßÂ∏Å",
    "settings.currency_modal_use_saved": "‰ΩøÁî®Â∑≤‰øùÂ≠òËÆ°ÂàíÁöÑË¥ßÂ∏Å",
    "settings.push_notifications_title": "Êé®ÈÄÅÈÄöÁü•",
    "settings.push_notifications_subtitle": "Êé•Êî∂ÊîØÂá∫ÊèêÈÜí",
    "settings.biometric_title": "ÁîüÁâ©ËØÜÂà´ËÆ§ËØÅ",
    "settings.biometric_subtitle": "‰ΩøÁî® Face ID Êàñ Touch ID",
    "settings.dark_mode_title": "Ê∑±Ëâ≤Ê®°Âºè",
    "settings.dark_mode_subtitle": "ÂêØÁî®Ê∑±Ëâ≤‰∏ªÈ¢ò",
    "settings.personal_info_title": "‰∏™‰∫∫‰ø°ÊÅØ",
    "settings.personal_info_subtitle": "‰øÆÊîπÊÇ®ÁöÑËµÑÊñô",
    "settings.personal_info_alert_title": "‰∏™‰∫∫ËµÑÊñô",
    "settings.personal_info_alert_body": "ÂäüËÉΩÂç≥Â∞ÜÊé®Âá∫",
    "settings.logout_title": "ÈÄÄÂá∫ÁôªÂΩï",
    "settings.logout_subtitle": "ÈÄÄÂá∫ÊÇ®ÁöÑË¥¶Êà∑",
    "settings.delete_account_title": "Âà†Èô§Ë¥¶Êà∑",
    "settings.delete_account_subtitle": "Ê∞∏‰πÖÂà†Èô§ÊÇ®ÁöÑË¥¶Êà∑",
    
    // Common
    "common.save": "‰øùÂ≠ò",
    "common.cancel": "ÂèñÊ∂à",
    "common.confirm": "Á°ÆËÆ§",
    "common.error": "ÈîôËØØ",
    "common.success": "ÊàêÂäü",
    "common.loading": "Âä†ËΩΩ‰∏≠...",
    "home.prediction_message_day_default": "‰ªäÂ§©ÁöÑÊîØÂá∫‰Ωé‰∫éÈ¢ÑÊúüÔºåÁªßÁª≠‰øùÊåÅÔºÅ",
    "home.prediction_message_2weeks_default": "‰Ω†ÁõÆÂâçÁöÑÂºÄÈîÄÊéßÂà∂ÂæóÂæàÂ•Ω„ÄÇ",
    "home.prediction_message_month_default": "Êú¨ÊúàÂèØ‰ª•‰∫âÂèñÂ§öÂÇ®ËìÑ‰∏Ä‰∫õ„ÄÇ",
    "home.category_food": "È£üÁâ©",
    "home.category_shopping": "Ë¥≠Áâ©",
    "home.category_leisure": "‰ºëÈó≤",
    "details.title": "Âø´ÈÄüÈ¢ÑÁÆóËÆ°Âàí",
    "details.monthly_income_label": "ÊØèÊúàÊî∂ÂÖ• (EUR)",
    "details.monthly_income_placeholder": "‰æãÔºö2500",
    "details.savings_target_label": "ÊØèÊúàÂÇ®ËìÑÁõÆÊ†á",
    "details.savings_target_placeholder": "‰æãÔºö700",
    "details.calculate_button": "ËÆ°ÁÆó",
    "details.recommendations_title": "Âª∫ËÆÆ",
    "details.recommendations_monthly": "ÊØèÊúàÊîØÂá∫Ôºö{amount}",
    "details.recommendations_weekly": "ÊØèÂë®ÊîØÂá∫Ôºö{amount}",
    "details.recommendations_daily": "ÊØèÊó•ÊîØÂá∫Ôºö{amount}",
    "details.go_to_advisor": "Êü•ÁúãËØ¶ÁªÜËÆ°Âàí",
  },
  
  ja: {
    // Navigation
    "nav.home": "„Éõ„Éº„É†",
    "nav.advisor": "„Ç¢„Éâ„Éê„Ç§„Ç∂„Éº",
    "nav.stats": "Áµ±Ë®à",
    "nav.settings": "Ë®≠ÂÆö",
    
    // Home Screen
    "home.title": "CashHeal",
    "home.subtitle": "„Çπ„Éû„Éº„Éà„Å´Ë≤°Âãô„ÇíÁÆ°ÁêÜ",
    "home.balance": "ÊÆãÈ´ò",
    "home.available": "Âà©Áî®ÂèØËÉΩ",
    "home.spent": "ÊîØÂá∫",
    "home.budget": "‰∫àÁÆó",
    "home.add_expense": "ÊîØÂá∫„ÇíËøΩÂä†",
    "home.categories": "„Ç´„ÉÜ„Ç¥„É™",
    "home.food": "È£ü‰∫ã",
    "home.shopping": "„Ç∑„Éß„ÉÉ„Éî„É≥„Ç∞",
    "home.leisure": "„É¨„Ç∏„É£„Éº",
    "home.welcome_heading": "„Çà„ÅÜ„Åì„ÅùÔºÅ",
    "home.greeting": "„Åì„Çì„Å´„Å°„ÅØ üëã",
    "home.welcome_subtitle": "ÂÆ∂Ë®à„ÇíÊï¥„Åà„ÇãÊ∫ñÂÇô„ÅØ„Åß„Åç„Åæ„Åó„Åü„ÅãÔºü",
    "home.today_spent": "‰ªäÊó•„ÅÆÊîØÂá∫",
    "home.daily_budget": "‰ªäÊó•„ÅÆ‰∫àÁÆó",
    "home.remaining_today": "‰ªäÊó•ÊÆã„Çä„ÅØ {amount} „Åß„Åô„ÄÇ",
    "home.period_day": "Êó•",
    "home.period_2weeks": "2ÈÄ±Èñì",
    "home.period_month": "Êúà",
    "home.weekly_average": "‰ªäÈÄ±„ÅÆÂπ≥Âùá",
    "home.prediction": "‰∫àÊ∏¨",
    "home.dashboard_title": "„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ",
    "home.modal_add_title": "ÊîØÂá∫„ÇíËøΩÂä†",
    "home.modal_remove_title": "ÊîØÂá∫„ÇíÂèñ„ÇäÊ∂à„Åô",
    "home.modal_category": "„Ç´„ÉÜ„Ç¥„É™",
    "home.modal_amount": "ÈáëÈ°ç",
    "home.modal_amount_placeholder": "ÈáëÈ°ç",
    
    // Budget Advisor
    "advisor.title": "‰∫àÁÆó„Ç¢„Éâ„Éê„Ç§„Ç∂„Éº",
    "advisor.subtitle": "„ÅÇ„Å™„Åü„ÅÆÂÄã‰∫∫ÁöÑ„Å™Ë≤°ÂãôË®àÁîª„Çí‰ΩúÊàê„Åó„Åæ„Åó„Çá„ÅÜ",
    "advisor.monthly_budget": "ÊúàÈñì‰∫àÁÆó„ÅØ„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü",
    "advisor.rent": "ÊúàÈñìÂÆ∂Ë≥É„ÅØ„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü",
    "advisor.daily_spending": "1Êó•„Å´„ÅÑ„Åè„Çâ‰Ωø„ÅÑ„Åü„ÅÑ„Åß„Åô„ÅãÔºü",
    "advisor.weekly_spending": "ÈÄ±„Å´„ÅÑ„Åè„Çâ‰Ωø„ÅÑ„Åü„ÅÑ„Åß„Åô„ÅãÔºü",
    "advisor.biweekly_spending": "2ÈÄ±Èñì„Åî„Å®„Å´„ÅÑ„Åè„Çâ‰Ωø„ÅÑ„Åü„ÅÑ„Åß„Åô„ÅãÔºü",
    "advisor.monthly_spending": "Êúà„Å´„ÅÑ„Åè„Çâ‰Ωø„ÅÑ„Åü„ÅÑ„Åß„Åô„ÅãÔºü",
    "advisor.savings_goal": "Ë≤ØËìÑÁõÆÊ®ô„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
    "advisor.savings_30": "ÊúÄÂ§ß„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ôºà30%Ë≤ØËìÑÔºâ",
    "advisor.savings_balanced": "„Éê„É©„É≥„ÇπÔºà15%Ë≤ØËìÑÔºâ",
    "advisor.savings_invest": "ÊäïË≥áÔºà5%Ë≤ØËìÑÔºâ",
    "advisor.calculate": "ÁßÅ„ÅÆË®àÁîª„ÇíË®àÁÆó",
    "advisor.save": "‰øùÂ≠ò",
    "advisor.continue": "Á∂öË°å",
    "advisor.back": "Êàª„Çã",
    "advisor.result_title": "„ÅÇ„Å™„Åü„ÅÆ‰∫àÁÆóË®àÁîª",
    "advisor.fixed_charges": "Âõ∫ÂÆöË≤ª",
    "advisor.available_spending": "ÊîØÂá∫ÂèØËÉΩÈ°ç",
    "advisor.daily_budget": "Êó•Ê¨°‰∫àÁÆó",
    "advisor.weekly_budget": "ÈÄ±Ê¨°‰∫àÁÆó",
    "advisor.biweekly_budget": "ÈöîÈÄ±‰∫àÁÆó",
    
    // Settings
    "settings.title": "Ë®≠ÂÆö",
    "settings.currency": "ÈÄöË≤®",
    "settings.language": "Ë®ÄË™û",
    "settings.country": "ÂõΩ",
    "settings.notifications": "ÈÄöÁü•",
    "settings.biometric": "Áîü‰ΩìË™çË®º",
    "settings.dark_mode": "„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ",
    "settings.personal_info": "ÂÄã‰∫∫ÊÉÖÂ†±",
    "settings.logout": "„É≠„Ç∞„Ç¢„Ç¶„Éà",
    "settings.subtitle": "‰ΩìÈ®ì„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫",
    "settings.section_preferences": "Âü∫Êú¨Ë®≠ÂÆö",
    "settings.section_security": "„Çª„Ç≠„É•„É™„ÉÜ„Ç£",
    "settings.section_appearance": "Â§ñË¶≥",
    "settings.section_account": "„Ç¢„Ç´„Ç¶„É≥„Éà",
    "settings.section_actions": "Êìç‰Ωú",
    "settings.choose_language": "Â∏åÊúõ„ÅÆË®ÄË™û„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
    "settings.choose_country": "ÂõΩ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
    "settings.currency_modal_title": "ÈÄöË≤®„ÇíÈÅ∏Êäû",
    "settings.currency_modal_use_saved": "‰øùÂ≠ò„Åï„Çå„Åü„Éó„É©„É≥„ÅÆÈÄöË≤®„Çí‰ΩøÁî®",
    "settings.push_notifications_title": "„Éó„ÉÉ„Ç∑„É•ÈÄöÁü•",
    "settings.push_notifications_subtitle": "ÊîØÂá∫„ÅÆÈÄöÁü•„ÇíÂèó„ÅëÂèñ„Çã",
    "settings.biometric_title": "Áîü‰ΩìË™çË®º",
    "settings.biometric_subtitle": "Face ID / Touch ID „Çí‰ΩøÁî®",
    "settings.dark_mode_title": "„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ",
    "settings.dark_mode_subtitle": "„ÉÄ„Éº„ÇØ„ÉÜ„Éº„Éû„ÇíÊúâÂäπ„Å´„Åô„Çã",
    "settings.personal_info_title": "ÂÄã‰∫∫ÊÉÖÂ†±",
    "settings.personal_info_subtitle": "„Éó„É≠„Éï„Ç£„Éº„É´„ÇíÁ∑®ÈõÜ",
    "settings.personal_info_alert_title": "„Éó„É≠„Éï„Ç£„Éº„É´",
    "settings.personal_info_alert_body": "ËøëÊó•ÂÖ¨Èñã",
    "settings.logout_title": "„É≠„Ç∞„Ç¢„Ç¶„Éà",
    "settings.logout_subtitle": "„Ç¢„Ç´„Ç¶„É≥„Éà„Åã„Çâ„Çµ„Ç§„É≥„Ç¢„Ç¶„Éà",
    "settings.delete_account_title": "„Ç¢„Ç´„Ç¶„É≥„ÉàÂâäÈô§",
    "settings.delete_account_subtitle": "„Ç¢„Ç´„Ç¶„É≥„Éà„ÇíÂÆåÂÖ®„Å´ÂâäÈô§",
    
    // Common
    "common.save": "‰øùÂ≠ò",
    "common.cancel": "„Ç≠„É£„É≥„Çª„É´",
    "common.confirm": "Á¢∫Ë™ç",
    "common.error": "„Ç®„É©„Éº",
    "common.success": "ÊàêÂäü",
    "common.loading": "Ë™≠„ÅøËæº„Åø‰∏≠...",
    "home.prediction_message_day_default": "‰ªäÊó•„ÅØ‰∫àÂÆö„Çà„ÇäÂá∫Ë≤ª„ÅåÂ∞ë„Å™„Åè„ÄÅ„ÅÑ„ÅÑË™øÂ≠ê„Åß„ÅôÔºÅ",
    "home.prediction_message_2weeks_default": "„Åì„ÅÆË™øÂ≠ê„Å™„Çâ‰∫àÁÆóÂÜÖ„Å´Âèé„Åæ„Çä„Åù„ÅÜ„Åß„Åô„ÄÇ",
    "home.prediction_message_month_default": "‰ªäÊúà„ÅØ„ÇÇ„ÅÜÂ∞ë„ÅóË≤ØËìÑ„ÇíÁõÆÊåá„Åõ„Åæ„Åô„ÄÇ",
    "home.category_food": "È£ü‰∫ã",
    "home.category_shopping": "„Ç∑„Éß„ÉÉ„Éî„É≥„Ç∞",
    "home.category_leisure": "„É¨„Ç∏„É£„Éº",
    "details.title": "„ÇØ„Ç§„ÉÉ„ÇØ‰∫àÁÆó„Éó„É©„É≥",
    "details.monthly_income_label": "ÊúàÂèé (EUR)",
    "details.monthly_income_placeholder": "‰æãÔºö2500",
    "details.savings_target_label": "ÊúàÈñìË≤ØËìÑÁõÆÊ®ô",
    "details.savings_target_placeholder": "‰æãÔºö700",
    "details.calculate_button": "Ë®àÁÆó„Åô„Çã",
    "details.recommendations_title": "„Åä„Åô„Åô„ÇÅ",
    "details.recommendations_monthly": "ÊúàÈñìÊîØÂá∫Ôºö{amount}",
    "details.recommendations_weekly": "ÈÄ±ÈñìÊîØÂá∫Ôºö{amount}",
    "details.recommendations_daily": "Êó•Ê¨°ÊîØÂá∫Ôºö{amount}",
    "details.go_to_advisor": "Ë©≥Á¥∞„Éó„É©„É≥„ÇíË¶ã„Çã",
  },
};

const LanguageContext = createContext<LanguageCtx | null>(null);

const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguageState] = useState<Language>("fr");

  useEffect(() => {
    (async () => {
      try {
        const stored = await storage.getItem(STORAGE_KEY);
        if (stored && SUPPORTED_LANGUAGES.includes(stored as Language)) {
          setLanguageState(stored as Language);
        }
      } catch (error) {
        console.warn("Impossible de charger la langue sauvegard√©e", error);
      }
    })();
  }, []);

  const setLanguage = useCallback(async (nextLanguage: Language) => {
    setLanguageState(nextLanguage);
    try {
      await storage.setItem(STORAGE_KEY, nextLanguage);
    } catch (error) {
      console.warn("Impossible d'enregistrer la langue", error);
    }
  }, []);

  const t = useCallback((key: string): string => {
    return translations[language][key] || key;
  }, [language]);

  const value = useMemo(() => ({ language, setLanguage, t }), [language, setLanguage, t]);

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
};

export function useLanguage() {
  const ctx = useContext(LanguageContext);
  if (!ctx) throw new Error("useLanguage must be used within LanguageProvider");
  return ctx;
}

export { LanguageProvider, SUPPORTED_LANGUAGES, LANGUAGE_NAMES, LANGUAGE_FLAGS };
